<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MoviesMauiApp.ViewModels"
             xmlns:model="clr-namespace:MoviesMauiApp.Models"
             x:Class="MoviesMauiApp.Views.HistoryPage"
             Title="{Binding Title}">

    <Grid RowDefinitions="Auto, *">
        <!-- Stats Chart -->
        <Border Grid.Row="0" Margin="10" Padding="10" BackgroundColor="{AppThemeBinding Light=#F5F5F5, Dark=#333333}" StrokeShape="RoundRectangle 10">
            <VerticalStackLayout Spacing="5">
                <Label Text="Top Genres Watched" FontAttributes="Bold" FontSize="16"/>
                <CollectionView ItemsSource="{Binding Stats}" HeightRequest="120">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="vm:GenreStat">
                            <Grid ColumnDefinitions="100, *" Padding="0,2">
                                <Label Grid.Column="0" Text="{Binding Genre}" VerticalOptions="Center" FontAttributes="Bold"/>
                                <Label Grid.Column="1" Text="{Binding EmojiBar}" VerticalOptions="Center"/>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </Border>

        <!-- History List -->
        <CollectionView Grid.Row="1" ItemsSource="{Binding History}">
        <CollectionView.ItemsLayout>
            <LinearItemsLayout Orientation="Vertical" ItemSpacing="5"/>
        </CollectionView.ItemsLayout>
        <CollectionView.ItemTemplate>
            <DataTemplate x:DataType="model:HistoryEntry">
                <Border Margin="10,5" Padding="10" StrokeShape="RoundRectangle 5" StrokeThickness="1">
                    <Border.Stroke>
                        <AppThemeBinding Light="{StaticResource Gray200}" Dark="{StaticResource Gray600}"/>
                    </Border.Stroke>
                    <Border.BackgroundColor>
                        <AppThemeBinding Light="{StaticResource White}" Dark="#333333"/>
                    </Border.BackgroundColor>
                    
                    <Grid ColumnDefinitions="50, *, Auto">
                        <Label Text="{Binding MovieEmoji}" FontSize="24" VerticalOptions="Center" BackgroundColor="Transparent"/>
                        
                        <VerticalStackLayout Grid.Column="1" Spacing="0">
                            <Label Text="{Binding MovieTitle}" FontAttributes="Bold" TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"/>
                            <Label Text="{Binding MovieGenre}" FontSize="12" TextColor="{AppThemeBinding Light=Gray, Dark={StaticResource Gray300}}"/>
                        </VerticalStackLayout>
                        
                        <Label Grid.Column="2" Text="{Binding ViewedAt, StringFormat='{0:MMM dd HH:mm}'}" 
                               FontSize="10" TextColor="{AppThemeBinding Light=Gray, Dark={StaticResource Gray300}}" VerticalOptions="Center"/>
                    </Grid>
                </Border>
            </DataTemplate>
        </CollectionView.ItemTemplate>
    </CollectionView>

    </Grid>

</ContentPage>
