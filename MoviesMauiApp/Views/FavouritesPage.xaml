<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MoviesMauiApp.ViewModels"
             xmlns:model="clr-namespace:MoviesMauiApp.Models"
             x:Class="MoviesMauiApp.Views.FavouritesPage"
             Title="{Binding Title}">

    <Grid>

        <Label Text="No favourites yet!" 
               IsVisible="False"
               HorizontalOptions="Center" VerticalOptions="Center"
               TextColor="{AppThemeBinding Light=Gray, Dark=White}" FontSize="20">
            <Label.Triggers>
                <DataTrigger TargetType="Label" Binding="{Binding FavouriteMovies.Count}" Value="0">
                    <Setter Property="IsVisible" Value="True"/>
                </DataTrigger>
            </Label.Triggers>
        </Label>
             
        <CollectionView ItemsSource="{Binding FavouriteMovies}" SelectionMode="Single"
                        SelectionChangedCommand="{Binding GoToDetailsCommand}"
                        SelectionChangedCommandParameter="{Binding Source={RelativeSource Self}, Path=SelectedItem}">
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="10"/>
            </CollectionView.ItemsLayout>
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="model:Movie">
                    <Border Margin="10,5" Padding="0" StrokeShape="RoundRectangle 10" StrokeThickness="1">
                        <Border.Stroke>
                            <AppThemeBinding Light="{StaticResource Gray200}" Dark="{StaticResource Gray600}"/>
                        </Border.Stroke>
                        <Border.BackgroundColor>
                            <AppThemeBinding Light="{StaticResource White}" Dark="#333333"/>
                        </Border.BackgroundColor>
                        
                        <Grid ColumnDefinitions="80, *" HeightRequest="100">
                             <Label Text="{Binding Emoji}" 
                                   Grid.Column="0"
                                   FontSize="40"
                                   VerticalOptions="Center"
                                   HorizontalOptions="Center"
                                   BackgroundColor="{AppThemeBinding Light=#FFE0B2, Dark=#664400}"/>
                            
                            <VerticalStackLayout Grid.Column="1" Padding="10" Spacing="2" VerticalOptions="Center">
                                <Label Text="{Binding Title}" FontSize="18" FontAttributes="Bold" LineBreakMode="TailTruncation"
                                       TextColor="{AppThemeBinding Light={StaticResource Black}, Dark={StaticResource White}}"/>
                                <Label Text="{Binding Year}" FontSize="14" TextColor="{AppThemeBinding Light=Gray, Dark=Gray}"/>
                            </VerticalStackLayout>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
        
        <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" 
                           HorizontalOptions="Center" VerticalOptions="Center" Color="{StaticResource Primary}"/>
    </Grid>
</ContentPage>
